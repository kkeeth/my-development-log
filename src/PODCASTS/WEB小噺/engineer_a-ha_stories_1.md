# エンジニアあるある第１弾「うまくいっていると不安になる」

元ネタ

https://x.com/kan_naito_jp/status/1892770279891357897?s=46&t=zjX2DX2fsqyj0B7nD9gkgQ

## 台本

### オープニング
皆さんこんにちは。「雨宿りとWEBの小噺」へようこそ！パーソナリティの Keeth こと桑原です。

この番組では，目まぐるしく変化するWeb業界の中，興味深い裏話や小噺など，ホッと一息つけるお話をお届けします．

今回の話題は，プログラマーなら一度は経験したことがある不思議な現象「シュレーディンバグ」についてお話します．

### 本題

私自身も何度も経験しているんですが、コードがうまく動かない、明らかにバグがある...でも、調査のためにconsole.logを入れた途端に、魔法のように正常に動き出す。そして以降、そのバグは二度と現れない...。

これって一体何なんでしょうか？

## シュレーディンバグとは？

シュレーディンバグという名前は、もちろん物理学の有名な思考実験「シュレーディンガーの猫」から来ています。

量子力学では、観察されるまでは粒子が複数の状態を同時に取りうるという原理があります。シュレーディンガーはこれを説明するために、箱の中の猫が生きているか死んでいるか、箱を開けて観察するまでは両方の状態が共存しているというパラドックスを提案しました。

これをプログラミングの世界に当てはめると、バグを観察しようとする行為そのものがバグの状態に影響を与えてしまう現象を「シュレーディンバグ」と呼びます。

## 実体験の共有

実際に私が経験した例をいくつか紹介します。

一番よくあるのが、JavaScriptのコードでconsole.logを追加したら突然バグが消えるパターンですね。「あれ？さっきまでエラーだったのに...」という。

もう一つの例は、本番環境では発生するけど、開発環境では再現しないというクラシックなパターン。開発者の悪夢ですよね。「動いてるところを見せてください」と言われても、見せようとすると動くという...。

## なぜ起こるのか？

シュレーディンバグが発生する技術的な理由はいくつかあります：

1. **タイミングの変化**: デバッグコードを追加すると、プログラムの実行タイミングが微妙に変わり、競合状態（race condition）が解消されることがあります。

2. **メモリの扱いの変化**: console.logを追加すると、変数のスコープや生存期間が変わることがあります。特にJavaScriptでは、オブジェクトの参照の扱いが変わることも。

3. **最適化の違い**: デバッグ用のコードを入れると、コンパイラの最適化の挙動が変わることがあります。

4. **量子効果..ではなく環境の微妙な違い**: 冗談半分ですが、宇宙線によるビット反転なんてこともごく稀にあります。ただ、通常は環境変数やシステムの負荷状態など、見えない要因の違いが原因です。

## エンジニアの心理

面白いのは、シュレーディンバグに対するエンジニアの心理反応です。

先ほど紹介したツイートにもありましたが、「バグがあるはずなのに見つからない → リリースされてしまう → 問題報告がない → 重大システムで使われている → それでも問題ない → 最終的に『誰かが直したのだろう』と思うことにする」

これって、不確実性に対する人間の対処法として実に興味深いですよね。スーパーポジションにあるバグの状態を、自分の精神の安定のために「解決された」と解釈する。

### ジョークコーナー

プログラマー同士で交わされるジョークがあります：

「なぜQAエンジニアは量子力学が嫌いなのか？」
「観測すると状態が変わってしまうからだ！」

あるいは：

「私のコードには量子の不確定性原理が適用されます。バグの位置と存在を同時に正確に知ることはできません。」

### 対処法

シュレーディンバグと戦うための実用的なアドバイスをいくつか：

1. **ロギングのレベルを上げる**: console.logだけでなく、体系的なロギングを実装する

2. **再現性を高める**: 自動テストでバグを捕捉する仕組みを作る

3. **非同期処理に注意**: 特にJavaScriptでは、非同期処理が予期せぬタイミング問題を引き起こすことがしばしば

4. **環境の一貫性**: 開発環境と本番環境の差を最小限に

5. **謙虚であれ**: 完璧に動くコードにも疑いの目を持つ（最初のツイートのように）

では、そろそろ今回もお時間になりましたのでエンディングです．

### エンディング

結局のところ、プログラミングは科学であると同時に、時に魔術のような側面も持ち合わせているのかもしれません。シュレーディンバグはその象徴とも言えるでしょう。

バグが消えたとき、「なぜ直ったのかわからないけど、とりあえず良かった」と思うのは人間として自然な反応です。ただ、真のエンジニアは根本原因の追求を諦めません...が、それでも原因不明な事象はいくらでもあり「経過観察」で一旦蓋をすることもよくあります。

皆さんも不思議なバグ体験があれば、ぜひコメントで教えてください。次回以降のエピソードでご紹介するかもしれません。


この番組面白かったよーという方は，ぜひチャンネル登録もお願いします．もし聴いていて気になることや、話してほしいトピック，感想などありましたら、概要欄のフォームや，𝕏 でハッシュタグ「WEB 小噺」でつぶやいてください！web はアルファベット，「小噺」は漢字でもひらがなでも大丈夫です！

それでは、また雨宿りしに来てください。今回もお聴きくださりありがとうございました！「雨宿りと WEB の小噺」お相手は Keeth でした。さようなら！
